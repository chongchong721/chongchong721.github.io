<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Prefiltered Env Map Numerical Computation | Yuan’s site(MY site)</title>
<meta name="generator" content="Jekyll v3.10.0">
<meta property="og:title" content="Prefiltered Env Map Numerical Computation">
<meta property="og:locale" content="en_US">
<meta name="description" content="A Note on Prefiltered GGX Environment Map">
<meta property="og:description" content="A Note on Prefiltered GGX Environment Map">
<link rel="canonical" href="https://chongchong721.github.io/2024/11/22/prefiltered-env-map-numerical-computation.html">
<meta property="og:url" content="https://chongchong721.github.io/2024/11/22/prefiltered-env-map-numerical-computation.html">
<meta property="og:site_name" content="Yuan’s site(MY site)">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-11-22T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Prefiltered Env Map Numerical Computation">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-22T00:00:00+00:00","datePublished":"2024-11-22T00:00:00+00:00","description":"A Note on Prefiltered GGX Environment Map","headline":"Prefiltered Env Map Numerical Computation","mainEntityOfPage":{"@type":"WebPage","@id":"https://chongchong721.github.io/2024/11/22/prefiltered-env-map-numerical-computation.html"},"url":"https://chongchong721.github.io/2024/11/22/prefiltered-env-map-numerical-computation.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
<link type="application/atom+xml" rel="alternate" href="https://chongchong721.github.io/feed.xml" title="Yuan's site(MY site)">
<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Yuan's site(MY site)</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Myself</a></div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Prefiltered Env Map Numerical Computation</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-11-22T00:00:00+00:00" itemprop="datePublished">Nov 22, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h4 id="a-note-on-prefiltered-ggx-environment-map">A Note on Prefiltered GGX Environment Map</h4>

<p>The famous first term of Epic split sum approximation:
$$
\frac{1}{N}\sum_{k=1}^N L(l_k)
$$</p>

<p>They use this form because they are doing importance sampling and then Monte Carlo.</p>

<p>When you importance sampling the lighting direction according to GGX NDF, the actual pdf of this light direction is</p>

<p>$$
pdf(l) = pdf(\omega_m)*\frac{1}{4\langle v,\omega_m \rangle}
$$</p>

<p>where $\frac{1}{4cos}$ is the Jacobian from half vector to light/view direction</p>

<p>And, note that, the way to importance sample GGX NDF(<em>not actually GGX NDF</em>) is</p>

<p>$$
\theta_m = \arctan{(\frac{\alpha \sqrt{\xi_1}}{\sqrt{1-\xi_1}})}
$$</p>

<p>$$
\phi_m = 2\pi \xi_2
$$</p>

<p>After taking the Jacobian from spherical coordinate to solid angle:$d\omega = \sin{\theta}d\theta d\phi$</p>

<p>We will get:</p>

<p>$$
pdf(\omega_m) = D(\omega_m)\langle \omega_m,n \rangle
$$</p>

<p>For the above part, refer to https://schuttejoe.github.io/post/ggximportancesamplingpart1/</p>

<p>This means, when you are sampling $\theta$ and $\phi$ using the above formula provided by the original GGX paper, you are actually importance sampling $D(\omega_m)\langle \omega_m,n \rangle$, not $D(\omega_m)$, some literature is not very clear on this.</p>

<p>So, actually we are computing the integral:</p>

<p>$$
\int L(l)D(\omega_m)\langle \omega_m,n \rangle \frac{1}{4\langle v,\omega_m \rangle}dl
$$</p>

<p>So, if you are doing numerical integration , be sure to directly compute this term and add it up. And don’t forget any Jacobian involved. Or, if you are doing something differently than Epic, be sure to derive a different prefiltering formula.</p>

<p>If you stick to the assumption of $n=v=r$, then the cosine term cancels out</p>

<p>Then, Epic states that, they’ve found adding another term $\langle l,n \rangle$ can help the result to be better. This is purely added empirically, there is no math behind this. In the end, all of these are just approximations, so probably we should stick to what gives a better result.</p>

  </div>
<a class="u-url" href="/2024/11/22/prefiltered-env-map-numerical-computation.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Yuan's site(MY site)</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Yuan's site(MY site)</li>
<li><a class="u-email" href="mailto:fbzq125689@gmail.com">fbzq125689@gmail.com</a></li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/chongchong721"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">chongchong721</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Personal website for sharing interesting things</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
